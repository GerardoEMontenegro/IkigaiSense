{% extends 'layouts/general_layout.html' %}
{% load widget_tweaks %}
{% load static %}


{% block title %}Cambiar avatar{% endblock title %}

{% block content %}
<div class="min-h-screen bg-[#F6F2E6] text-[#3F4F36] flex justify-center items-start py-12 px-4">
  <div class="bg-white rounded-2xl shadow-md w-full max-w-md p-8">

    <h2 class="text-2xl font-bold mb-6">Cambiar avatar</h2>

    <form method="post" enctype="multipart/form-data" class="space-y-6">
      {% csrf_token %}

      <div>
        <label for="{{ form.avatar.id_for_label }}" class="block mb-2 text-sm font-medium">Nuevo avatar</label>
        {{ form.avatar|add_class:"block w-full text-sm text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-[#3F4F36] focus:border-[#3F4F36]" }}
        {% if form.avatar.errors %}
          <p class="text-red-500 text-sm mt-1">{{ form.avatar.errors.0 }}</p>
        {% endif %}
      </div>

      <!-- Previsualización -->
      <div id="preview-container" class="hidden mt-4">
        <p class="text-sm mb-2">Vista previa:</p>
        <img id="avatar-preview" class="w-24 h-24 rounded-full object-cover border border-gray-300" />
      </div>

      <button type="submit" class="w-full bg-[#3F4F36] hover:bg-[#2f3c28] text-white font-semibold py-2 px-4 rounded-md transition">
        Guardar cambios
      </button>
    </form>

    <div class="mt-6 text-center">
      <a href="{% url 'user:user_profile' %}" class="text-sm text-[#3F4F36] hover:underline">
        ← Volver al perfil
      </a>
    </div>

  </div>
</div>

<script>
  const fileInput = document.querySelector('input[type="file"]');
  const previewContainer = document.getElementById('preview-container');
  const previewImage = document.getElementById('avatar-preview');

  fileInput.addEventListener('change', function () {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      previewContainer.classList.remove('hidden');

      reader.addEventListener("load", function () {
        previewImage.setAttribute("src", this.result);
      });

      reader.readAsDataURL(file);
    } else {
      previewContainer.classList.add('hidden');
    }
  });
</script>
{% endblock content %}

